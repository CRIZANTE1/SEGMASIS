# üìä Matriz de Normas Regulamentadoras
**Sistema SEGMA-SIS | Documenta√ß√£o T√©cnica**

Este documento descreve todas as Normas Regulamentadoras (NRs) do Minist√©rio do Trabalho e Emprego que s√£o gerenciadas pelo SEGMA-SIS, incluindo suas regras de valida√ß√£o, c√°lculo de vencimento e requisitos espec√≠ficos.

---

## üìë √çndice

- [Vis√£o Geral](#-vis√£o-geral)
- [NRs Implementadas](#-nrs-implementadas)
- [Regras de Vencimento](#-regras-de-vencimento)
- [Valida√ß√£o de Carga Hor√°ria](#-valida√ß√£o-de-carga-hor√°ria)
- [Casos Especiais](#-casos-especiais)
- [Refer√™ncias Normativas](#-refer√™ncias-normativas)

---

## üéØ Vis√£o Geral
O SEGMA-SIS gerencia treinamentos de seguran√ßa do trabalho de acordo com as Normas Regulamentadoras do MTE. Cada norma possui regras espec√≠ficas para:

- **Carga hor√°ria m√≠nima** (forma√ß√£o inicial e reciclagem)
- **Periodicidade de reciclagem** (validade do treinamento)
- **M√≥dulos espec√≠ficos** (quando aplic√°vel)
- **Requisitos de conte√∫do program√°tico**

### Tipos de Treinamento

- **Forma√ß√£o Inicial:** Primeiro treinamento do trabalhador na atividade.
- **Reciclagem:** Atualiza√ß√£o peri√≥dica obrigat√≥ria para manter a validade.

---

## üìö NRs Implementadas

### NR-01 - Disposi√ß√µes Gerais e Gerenciamento de Riscos Ocupacionais
- **Status:** ‚úÖ Implementado (Auditoria de PGR)
- **Documentos Gerenciados:**
  - Programa de Gerenciamento de Riscos (PGR)
  - Plano de A√ß√£o
- **Requisitos de Auditoria:**
  - Invent√°rio de riscos com avalia√ß√£o (severidade + probabilidade)
  - Plano de a√ß√£o estruturado (cronograma + respons√°veis)
  - Procedimentos de emerg√™ncia
  - Data de emiss√£o e assinaturas
- **Regras de Vencimento:**
  - **PGR:** 2 anos a partir da data de emiss√£o.
  - Revis√£o obrigat√≥ria em caso de mudan√ßa de risco.

### NR-06 - Equipamentos de Prote√ß√£o Individual (EPI)
- **Status:** ‚úÖ Implementado

| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 3 horas  | 3 horas    | 10 anos       |

- **Documentos Gerenciados:**
  - Fichas de Controle de EPI
  - Certificados de treinamento
- **Campos Obrigat√≥rios (Ficha de EPI):**
  - Nome do funcion√°rio
  - Descri√ß√£o do EPI
  - Certificado de Aprova√ß√£o (CA)
  - Data de entrega
  - Assinatura do trabalhador
- **Observa√ß√µes:**
  - Periodicidade muito longa (10 anos) devido √† natureza do treinamento.
  - Foco em conscientiza√ß√£o sobre uso correto.

### NR-10 - Seguran√ßa em Instala√ß√µes e Servi√ßos em Eletricidade
- **Status:** ‚úÖ Implementado (com m√≥dulos)

#### M√≥dulos Dispon√≠veis
**NR-10 B√°sico**
| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 40 horas | 40 horas   | 2 anos        |
- **Aplic√°vel a:**
  - Trabalhadores que interagem com instala√ß√µes el√©tricas energizadas.
  - Tens√£o at√© 1000V (Baixa Tens√£o).

**NR-10 SEP (Sistema El√©trico de Pot√™ncia)**
| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 40 horas | 40 horas   | 2 anos        |
- **Aplic√°vel a:**
  - Trabalhadores em subesta√ß√µes.
  - Alta tens√£o (acima de 1000V).
  - Sistema El√©trico de Pot√™ncia.

‚ö†Ô∏è **IMPORTANTE:** NR-10 B√°sico **N√ÉO** cobre NR-10 SEP. S√£o treinamentos distintos.

- **Detec√ß√£o Autom√°tica (IA):**
  O sistema identifica automaticamente se o certificado √© SEP atrav√©s de palavras-chave:
  - "SEP"
  - "Sistema El√©trico de Pot√™ncia"
  - "Alta Tens√£o"
  - "Subesta√ß√£o"

### NR-11 - Transporte, Movimenta√ß√£o, Armazenagem e Manuseio de Materiais
- **Status:** ‚úÖ Implementado

| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 16 horas | 16 horas   | 3 anos        |

- **Aplic√°vel a:**
  - Operadores de empilhadeiras
  - Operadores de pontes rolantes
  - Movimenta√ß√£o de cargas
- **Observa√ß√µes:**
  - Carga hor√°ria pode variar de 16 a 32 horas dependendo do equipamento.
  - Sistema valida m√≠nimo de 16 horas.

### NR-12 - Seguran√ßa no Trabalho em M√°quinas e Equipamentos
- **Status:** ‚úÖ Implementado

| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 8 horas  | 8 horas    | 5 anos        |

- **Aplic√°vel a:**
  - Operadores de m√°quinas
  - Manuten√ß√£o de equipamentos
  - Trabalhos com dispositivos de seguran√ßa
- **Observa√ß√µes:**
  - Periodicidade de 5 anos (mais longa que a maioria).
  - Foco em prote√ß√µes mec√¢nicas e dispositivos de seguran√ßa.

### NR-18 - Condi√ß√µes e Meio Ambiente de Trabalho na Ind√∫stria da Constru√ß√£o
- **Status:** ‚úÖ Implementado

| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 8 horas  | 8 horas    | 1 ano         |

- **Aplic√°vel a:**
  - Trabalhadores da constru√ß√£o civil
  - Todos os n√≠veis hier√°rquicos
- **Conte√∫do Program√°tico M√≠nimo:**
  - Riscos na constru√ß√£o
  - Equipamentos de prote√ß√£o coletiva
  - Primeiros socorros
  - Ordem e limpeza

### NR-20 - Seguran√ßa e Sa√∫de no Trabalho com Inflam√°veis e Combust√≠veis
- **Status:** ‚úÖ Implementado (4 m√≥dulos)

#### Matriz de M√≥dulos
| M√≥dulo        | Forma√ß√£o | Periodicidade | Reciclagem (C.H.) | Aplic√°vel a                               |
|---------------|----------|---------------|-------------------|-------------------------------------------|
| **B√°sico**      | 8 horas  | 3 anos        | 4 horas           | Trabalhadores em postos de combust√≠vel    |
| **Intermedi√°rio** | 16 horas | 2 anos        | 4 horas           | Operadores de processos                   |
| **Avan√ßado I**  | 20 horas | 2 anos        | 4 horas           | Manuten√ß√£o e inspe√ß√£o                     |
| **Avan√ßado II** | 32 horas | 1 ano         | 4 horas           | Opera√ß√µes cr√≠ticas                        |

- **Detec√ß√£o Autom√°tica (IA):**
  O sistema infere o m√≥dulo pela carga hor√°ria do certificado quando n√£o expl√≠cito.
- **Valida√ß√£o Especial:**
  ```python
  # Exemplo de l√≥gica de valida√ß√£o NR-20
  if norma == "NR-20":
      if modulo == "B√°sico" and carga_horaria < 8:
          return False, "B√°sico requer 8h"
      elif modulo == "Intermedi√°rio" and carga_horaria < 16:
          return False, "Intermedi√°rio requer 16h"
      # ... etc
  ```

### NR-33 - Seguran√ßa e Sa√∫de nos Trabalhos em Espa√ßos Confinados
- **Status:** ‚úÖ Implementado (2 m√≥dulos)

#### M√≥dulos Dispon√≠veis
**Trabalhador Autorizado**
| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 16 horas | 8 horas    | 1 ano         |
- **Aplic√°vel a:** Trabalhadores que entram em espa√ßos confinados.

**Supervisor de Entrada**
| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 40 horas | 8 horas    | 1 ano         |
- **Aplic√°vel a:** Profissionais que autorizam e supervisionam entradas.

- **Conte√∫do Program√°tico Obrigat√≥rio:**
  - Identifica√ß√£o de espa√ßos confinados
  - Avalia√ß√£o de riscos
  - Teste de atmosfera
  - Procedimentos de resgate
- **Observa√ß√µes:**
  - Periodicidade anual (rigorosa).
  - Reciclagem √∫nica de 8h para ambos os m√≥dulos.

### NR-34 - Condi√ß√µes e Meio Ambiente de Trabalho na Ind√∫stria da Constru√ß√£o e Repara√ß√£o Naval
- **Status:** ‚úÖ Implementado

| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 8 horas  | 8 horas    | 1 ano         |

- **Aplic√°vel a:**
  - Trabalhadores da ind√∫stria naval
  - Estaleiros

### NR-35 - Trabalho em Altura
- **Status:** ‚úÖ Implementado

| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 8 horas  | 8 horas    | 2 anos        |

- **Aplic√°vel a:** Trabalhadores que executam atividades acima de 2 metros do n√≠vel inferior.
- **Conte√∫do Program√°tico Obrigat√≥rio:**
  - An√°lise de risco
  - Equipamentos de prote√ß√£o individual
  - Sistemas de ancoragem
  - T√©cnicas de resgate
- **Observa√ß√µes:**
  - Uma das NRs mais comuns no sistema.
  - Periodicidade de 2 anos.

### NBR 16710 - Resgate T√©cnico
- **Status:** ‚úÖ Implementado
- **Modalidade:** Resgate T√©cnico Industrial

| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 24 horas | 24 horas   | 2 anos        |

- **Aplic√°vel a:**
  - Equipes de resgate em altura
  - Equipes de resgate em espa√ßos confinados
  - Brigadistas especializados
- **Observa√ß√µes:**
  - Norma ABNT (n√£o √© NR do MTE).
  - Treinamento altamente especializado.
  - Exige pr√°tica e certifica√ß√£o.

### Brigada de Inc√™ndio (IT-17 / NR-23)
- **Status:** ‚úÖ Implementado (2 n√≠veis)

**Brigada B√°sica**
| Item      | Forma√ß√£o      | Reciclagem | Periodicidade |
|-----------|---------------|------------|---------------|
| Carga Hor√°ria | N√£o especificado | Anual      | 1 ano         |

**Brigada Avan√ßada**
| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 24 horas | 16 horas   | 1 ano         |

- **Aplic√°vel a:**
  - Brigadistas volunt√°rios
  - Equipes de emerg√™ncia
- **Observa√ß√µes:**
  - Refer√™ncia √† IT-17 do Corpo de Bombeiros (SP).
  - Periodicidade anual rigorosa.

### Permiss√£o de Trabalho (PT)
- **Status:** ‚úÖ Implementado (2 m√≥dulos)

**Emitente de PT**
| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 16 horas | 4 horas    | 1 ano         |
- **Aplic√°vel a:** Profissionais que emitem Permiss√µes de Trabalho.

**Requisitante de PT**
| Item      | Forma√ß√£o | Reciclagem | Periodicidade |
|-----------|----------|------------|---------------|
| Carga Hor√°ria | 8 horas  | 4 horas    | 1 ano         |
- **Aplic√°vel a:** Profissionais que solicitam Permiss√µes de Trabalho.

- **Observa√ß√µes:**
  - N√£o √© uma NR formal, mas pr√°tica comum em ind√∫strias.
  - Sistema implementado devido √† alta demanda.

---

## ‚è∞ Regras de Vencimento

### C√°lculo Autom√°tico
O sistema calcula automaticamente a data de vencimento baseado em:
- Data de realiza√ß√£o do treinamento
- Norma identificada
- M√≥dulo (quando aplic√°vel)
- Tipo (forma√ß√£o ou reciclagem)

**Exemplo de implementa√ß√£o:**
```python
def calcular_vencimento_treinamento(data, norma, modulo, tipo_treinamento):
    if norma == "NR-20" and modulo:
        config = nr20_config.get(modulo)
        anos = config.get('reciclagem_anos')
    else:
        config = nr_config.get(norma)
        anos = config.get('reciclagem_anos')
    
    return data + relativedelta(years=anos)
```

### Tabela Resumo de Periodicidades
| Norma                       | Periodicidade        | Observa√ß√µes             |
|-----------------------------|----------------------|-------------------------|
| NR-06                       | 10 anos              | ‚è∞ Mais longa           |
| NR-12                       | 5 anos               | üìÖ Longa                |
| NR-11                       | 3 anos               | üìÖ M√©dia-longa          |
| NR-10, NR-35, NBR 16710     | 2 anos               | üìÖ Padr√£o               |
| NR-20 (depende do m√≥dulo)   | 1-3 anos             | üìÖ Vari√°vel             |
| NR-18, NR-33, NR-34, Brigada, PT | 1 ano              | ‚ö†Ô∏è Anual (rigorosa)    |

---

## ‚úÖ Valida√ß√£o de Carga Hor√°ria

### Processo de Valida√ß√£o
O sistema valida a carga hor√°ria em 3 etapas:

**1. Extra√ß√£o (IA - Gemini Flash)**
```python
# Prompt de extra√ß√£o
"""
Extraia do certificado:
- data_realizacao: DD/MM/AAAA
- norma: Nome da norma (ex: NR-10 SEP)
- modulo: M√≥dulo espec√≠fico
- tipo_treinamento: 'forma√ß√£o' ou 'reciclagem'
- carga_horaria: N√∫mero inteiro de horas
"""
```

**2. Valida√ß√£o de Neg√≥cio**
```python
def validar_treinamento(norma, modulo, tipo, carga_horaria):
    # Busca configura√ß√£o
    config = nr_config.get(norma)
    
    # Valida forma√ß√£o
    if tipo == 'forma√ß√£o' and 'inicial_horas' in config:
        if carga_horaria < config['inicial_horas']:
            return False, f"M√≠nimo {config['inicial_horas']}h"
    
    # Valida reciclagem
    elif tipo == 'reciclagem' and 'reciclagem_horas' in config:
        if carga_horaria < config['reciclagem_horas']:
            return False, f"M√≠nimo {config['reciclagem_horas']}h"
    
    return True, "Conforme"
```

**3. Auditoria com IA (Gemini Pro + RAG)**
```python
# Valida√ß√£o cruzada com base de conhecimento
audit_result = nr_analyzer.perform_initial_audit(doc_info, file_content)
```

### Regras Especiais

**NR-33 (Espa√ßos Confinados)**
- **Supervisor vs. Trabalhador:**
  - **Supervisor:** Forma√ß√£o de 40h, reciclagem de 8h.
  - **Trabalhador:** Forma√ß√£o de 16h, reciclagem de 8h.
- **Detec√ß√£o de m√≥dulo:**
  ```python
  if "supervisor" in modulo.lower():
      modulo_normalizado = "supervisor"
  elif "trabalhador" in modulo.lower() or "autorizado" in modulo.lower():
      modulo_normalizado = "trabalhador"
  ```

**Permiss√£o de Trabalho**
- **Emitente vs. Requisitante:**
  - **Emitente:** Forma√ß√£o de 16h, reciclagem de 4h.
  - **Requisitante:** Forma√ß√£o de 8h, reciclagem de 4h.

**NR-10 vs. NR-10 SEP**
- **Cr√≠tico:** S√£o treinamentos independentes:
  ```python
  # ‚ùå ERRADO: Considerar NR-10 B√°sico como v√°lido para NR-10 SEP
  if 'SEP' in norma_required:
      # Deve ter certificado espec√≠fico de SEP
      has_sep = any('SEP' in completed for completed in completed_trainings)
      if not has_sep:
          missing.append("NR-10 SEP")
  ```

---

## üîç Casos Especiais

**1. Treinamentos sem Vencimento**
- **ASO Demissional:**
  - N√£o possui vencimento.
  - Validade apenas para o ato de desligamento.

**2. Treinamentos com M√≥dulos M√∫ltiplos**
- **NR-20:**
  - Trabalhador pode ter m√∫ltiplos m√≥dulos simultaneamente.
  - Exemplo: B√°sico + Intermedi√°rio.
- **Sistema registra separadamente:**
  ```
  # Mesmo funcion√°rio, normas diferentes no DataFrame
  funcionario_id | norma  | modulo        | vencimento
  123           | NR-20  | B√°sico        | 2026-05-10
  123           | NR-20  | Intermedi√°rio | 2025-08-15
  ```

**3. Reciclagem antes do Vencimento**
- **Regra:** Reciclagem substitui a forma√ß√£o anterior.
  ```python
  # Sistema sempre pega o treinamento mais recente
  latest_trainings = trainings.sort_values('data', ascending=False).groupby(
      ['funcionario_id', 'norma', 'modulo']
  ).head(1)
  ```
- **Exemplo:**
  - Forma√ß√£o NR-35: 15/05/2020 (vence em 15/05/2022)
  - Reciclagem NR-35: 01/03/2022 (vence em 01/03/2024)
  - **Sistema mostra:** Apenas a reciclagem de 2022.

**4. Normaliza√ß√£o de Nomenclatura**
- **Problema:** Varia√ß√µes de escrita:
  - "NR 10" vs. "NR-10" vs. "NR10"
  - "BRIGADA" vs. "Brigada de Inc√™ndio" vs. "IT-17"
- **Solu√ß√£o:** Fun√ß√£o de padroniza√ß√£o.
  ```python
  def _padronizar_norma(norma):
      norma_upper = norma.strip().upper()
      
      if "BRIGADA" in norma_upper or "IT-17" in norma_upper:
          return "BRIGADA DE INC√äNDIO"
      
      if "RESGATE" in norma_upper or "16710" in norma_upper:
          return "NBR-16710 RESGATE T√âCNICO"
      
      if "PERMISS√ÉO" in norma_upper or "PT" in norma_upper:
          return "PERMISS√ÉO DE TRABALHO (PT)"
      
      # Normaliza NR-XX
      match = re.search(r'NR\s?-?(\d+)', norma_upper)
      if match:
          return f"NR-{int(match.group(1)):02d}"
      
      return norma_upper
  ```

---

## üìñ Refer√™ncias Normativas

### Legisla√ß√£o Base
- **Portaria MTE n¬∫ 3.214/1978**
  - Aprova as Normas Regulamentadoras.
  - √öltima atualiza√ß√£o: Portaria MTE n¬∫ 1.109/2016.

### NR-01 (Gerenciamento de Riscos)
- **Portaria SEPRT n¬∫ 6.730/2020**
  - Item 1.5: PGR
  - Item 1.7: Treinamentos

### IT-17 (Instru√ß√£o T√©cnica - Corpo de Bombeiros SP)
- **Decreto Estadual n¬∫ 63.911/2018**
  - Brigada de Inc√™ndio

### NBR 16710 (ABNT)
- Resgate T√©cnico Industrial
- Vers√£o: 2018

### Links Oficiais
- [MTE - Normas Regulamentadoras](https://www.gov.br/trabalho-e-emprego/pt-br/acesso-a-informacao/participacao-social/conselhos-e-orgaos-colegiados/comissao-tripartite-partitaria-permanente/arquivos/normas-regulamentadoras)
- [ABNT Cat√°logo](https://www.abnt.org.br/)

---

## üõ†Ô∏è Implementa√ß√£o T√©cnica

### Estrutura de Dados
**Dicion√°rio de Configura√ß√£o (Python):**
```python
nr_config = {
    'NR-35': {
        'inicial_horas': 8,
        'reciclagem_horas': 8,
        'reciclagem_anos': 2
    },
    'NR-10': {
        'inicial_horas': 40,
        'reciclagem_horas': 40,
        'reciclagem_anos': 2
    },
    # ... etc
}

nr20_config = {
    'B√°sico': {
        'inicial_horas': 8,
        'reciclagem_anos': 3,
        'reciclagem_horas': 4
    },
    # ... etc
}
```

### Fun√ß√µes Principais
- **Arquivo:** `operations/employee.py`
```python
class EmployeeManager:
    def calcular_vencimento_treinamento(self, data, norma, modulo, tipo):
        """Calcula vencimento baseado na norma"""
        
    def validar_treinamento(self, norma, modulo, tipo, carga_horaria):
        """Valida carga hor√°ria"""
        
    def _padronizar_norma(self, norma):
        """Normaliza nomenclatura"""
```

---

## üìä Estat√≠sticas de Uso
**NRs Mais Comuns (dados de produ√ß√£o):**

- **NR-35 (Trabalho em Altura)** - 35%
- **NR-10 (Eletricidade)** - 25%
- **NR-33 (Espa√ßos Confinados)** - 15%
- **NR-18 (Constru√ß√£o Civil)** - 10%
- **Brigada de Inc√™ndio** - 8%
- **Outras** - 7%

---

## üîÑ Manuten√ß√£o e Atualiza√ß√µes

### Como Adicionar uma Nova NR

1.  **Atualizar `nr_config` em `operations/employee.py`:**
    ```python
    'NR-XX': {
        'inicial_horas': XX,
        'reciclagem_horas': XX,
        'reciclagem_anos': X
    }
    ```
2.  **Adicionar l√≥gica de valida√ß√£o (se necess√°rio):**
    ```python
    def validar_treinamento(self, norma, modulo, tipo, carga_horaria):
        # ... c√≥digo existente ...
        
        if norma == "NR-XX":
            # L√≥gica espec√≠fica
            pass
    ```
3.  **Atualizar documenta√ß√£o:**
    - Adicionar se√ß√£o neste documento.
    - Atualizar `ui/ui_helpers.py` (expander de informa√ß√µes).
4.  **Testar:**
    - Upload de certificado.
    - C√°lculo de vencimento.
    - Valida√ß√£o de carga hor√°ria.
    - Matriz de conformidade.

---

## ‚úÖ Checklist de Conformidade
Para cada NR implementada:

- [ ] Carga hor√°ria m√≠nima definida
- [ ] Periodicidade de reciclagem definida
- [ ] Fun√ß√£o de valida√ß√£o implementada
- [ ] C√°lculo de vencimento testado
- [ ] Documenta√ß√£o atualizada
- [ ] Casos especiais documentados
- [ ] Testes de integra√ß√£o passando

---

*√öltima Atualiza√ß√£o: 14 de Outubro de 2025*
*Vers√£o do Documento: 2.0*
*Autor: Cristian Ferreira Carlos*
